image:
  repository: docker.io/jboss/keycloak
  # Overrides the Keycloak image tag whose default is the chart version
  tag: ""

replicas: 1

affinity: |
  nodeAffinity:
    requiredDuringSchedulingIgnoredDuringExecution:
      nodeSelectorTerms:
      - matchExpressions:
        - key: "node-role.kubernetes.io/infra"
          operator: Exists
  podAntiAffinity:
    requiredDuringSchedulingIgnoredDuringExecution:
      - labelSelector:
          matchLabels:
            app: keycloak  
            release: keycloak
        topologyKey: kubernetes.io/hostname

service:
  type: ClusterIP

resources:
  limits:
    cpu: 500m
    memory: 2048Mi
  requests:
    cpu: 250m
    memory: 512Mi

postgresql:
  enabled: false

extraEnv: |
  - name: DB_VENDOR
    value: postgres
  - name: DB_ADDR
    value: postgresql.infra.svc.cluster.local
  - name: DB_PORT
    value: "5432"
  - name: DB_DATABASE
    value: keycloak
  - name: DB_USER_FILE
    value: /secrets/db-creds/user
  - name: DB_PASSWORD_FILE
    value: /secrets/db-creds/password
  - name: KEYCLOAK_USER_FILE
    value: /secrets/creds/user
  - name: KEYCLOAK_PASSWORD_FILE
    value: /secrets/creds/password
  - name: KEYCLOAK_EXTRA_ARGS
    value: "-Dkeycloak.import=/config/realm.json"

extraVolumeMounts: |
  - name: db-creds
    mountPath: /secrets/db-creds
    readOnly: true
  - name: creds
    mountPath: /secrets/creds
    readOnly: true
  - name: config
    mountPath: "/config"
    readOnly: true    
extraVolumes: |
  - name: db-creds
    secret:
      secretName: keycloak-database
  - name: creds
    secret:
      secretName: keycloak
  - name: config
    configMap:
      name: keycloak-realm
      items:
      - key: realm.json
        path: realm.json

serviceMonitor:
  enabled: true
