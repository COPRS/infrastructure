# Certificates management in RS

## Ingress TLS configuration

Reference System exploits [APISIX Ingress Controller](https://apisix.apache.org/) and [Cert Manager](https://cert-manager.io/) for ingress TLS configuration.

You must set a Cert Manager [issuer](https://cert-manager.io/docs/concepts/issuer/) for the platform to generate a TLS ingress certificate.  
In your inventory, reach to `host_vars/setup/main.yaml` and configure `ingress_tls_certificate_issuer_spec`
with your issuer specs.  
For informations about how to configure your issuer, read the following documentation: https://cert-manager.io/docs/configuration/.

APISIX does not work with Cert Manager for ACME HTTP01 challenges ([#781](https://github.com/apache/apisix-ingress-controller/issues/781)).  
You must use the DNS01 challenge to generate a Let's encrypt certificate. The configuration is detailled on [Cert Manager documentation](https://cert-manager.io/docs/configuration/acme/dns01).

## Linkerd identity

Linkerd features requires to define pods identity in the cluster. To ensure this feature, it establishes
mTLS in the cluster relying on certificates.

Linkerd needs two certificate authorities: 

- the mTLS root certificate to secure pod-to-pod communications 
- the webhook root certificate to secure Linkerd webhooks traffic.

Those two CA are automatically generated by the playbook `generate_inventory.yaml`.  
By default, they are valid for 10 years. Upon expirations, they need to be manually rotated.

Linkerd exploits Cert Manager to automatically create and rotate the certificates issued by the previous defined CA.

## Stash community license

A **Stash community** licence is mandatory for the *stash operator* application, get one [here](https://license-issuer.appscode.com/?p=stash-community) and write it in the `main.yaml` inventory file.

## Kubernetes certificates

Kubeadm generates all certificates needed for a kubernetes cluster. These certificates expire after 1 year.
Kubeadm will take care of renewing the certificates upon cluster upgrade.

> Note: It is a best practice to upgrade your cluster frequently in order to stay secure.

To manually renew the certificates, read the [Kubernetes documentation](https://kubernetes.io/docs/tasks/administer-cluster/kubeadm/kubeadm-certs/#manual-certificate-renewal).

For more informations read [the documentation related to certificate management for Kubernetes](https://kubernetes.io/docs/tasks/administer-cluster/kubeadm/kubeadm-certs/).
