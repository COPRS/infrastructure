- name: get apps folders
  find:
    file_type: directory
    paths: "{{ app_paths }}"
  delegate_to: localhost
  register: result

- name: Initialize parsed app folders
  set_fact:
    parsed_apps: []

- name: Extract app path
  set_fact:
    # do not take file starting with .
    apps: "{{  result.files | sort(attribute='path') | map(attribute='path') | map('regex_search', regex) | list }}"
  vars:
    regex: '.+/[\w-]+[\w\.-]+$'

- name: install {{ app_name }}
  include_tasks: install.yaml
  vars:
    app_dir: "{{ apps | select('search', app_name) | first }}"
    # app_name: "{{ app_name | regex_search('^([0-9]{3})?-?(.+)', '\\2') | first }}"
  when: app_name is defined

- meta: end_play
  when: app_name is defined

- name: install apps
  include_tasks: install.yaml
  vars:
    app_name: "{{ item | basename | regex_search('^([0-9]{3})?-?(.+)', '\\2') | first }}"
    app_dir: "{{ item }}"
  loop: "{{ apps }}"
  when: app_name not in parsed_apps
