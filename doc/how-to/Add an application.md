# Add an application

Your application must be in a directory referenced in your inventory by ```app_path```.  
You can create several folder depending on your needs.

**For example**:

```yaml
# platform/inventory/sample/group_vars/gateway/app_installer.yaml

...

app_paths:
  - "{{ playbook_dir }}/../../apps"
  - "/home/foo/myproject/myapps"        # new directory added
```

Each folder contains a list of applications you will deploy on the platform.

For example: 
```Bash
$ ls -A1 ./apps
elasticsearch
graylog
kafka
keycloak
mongodb
openldap
postgresql
rook-ceph
rook-ceph-cluster
spring-cloud-dataflow
```
Hence, you have to create a folder for your app. It will contain all the files and configurations needed to run the app.

## Helm chart

This section covers the deployment of your application as a Helm chart.

Your repository must possess 2 files:
- **config.yaml**
- **values.yaml**

Example:
```
my-new-app/
    config.yaml
    values.yaml
```

> :warning: **the name of the folder defines the name of the release deployed.** 

The ```config.yaml``` file precise the name of the chart you deploy, its version and the namespace of the application.

```yaml
chart_ref: bitnami/kafka
chart_version: 14.2.3
namespace: infra
```

Below is the list of the supported variables.

| name | mandatory \| optional | default value |
|:---|:---:|---:|
| chart_ref | mandatory | | 
| chart_version | optional | latest |
| chart_repo_url | optional | |
| namespace | optional | default |

The ```values.yaml```, is the file where you write down the parameters you apply on the chart.  
You can find examples of this file, or documentation to explain you what to write on it, in the chart documentation of the application you install.

For Bitnami, the list of possible parameters is accessible in the [bitnami repository](https://github.com/bitnami/charts/tree/master/bitnami). You can read it on the README.&#xfeff;md of the folder related to the specific chart.  

## Kustomize

This section describe the deployment of an application using kustomize.

Your repository must contain a ```kustomization.yaml``` file.

> :warning: **This kustomization.yaml must defines at least the 2 following labels for all the resources: app.kubernetes.io/instance and app.kubernetes.io/managed-by**.  
Those labels are used to link the resources together and identify them in the deployment step.  

You can use the instruction ```commonLabels``` to add labels for all the resources.
```yaml
commonLabels:
  ...
  app.kubernetes.io/instance: MY_APP_NAME
  app.kubernetes.io/managed-by: Kustomize
```

## Kustomize with a Helm chart

Follow instructions given on the two sections above.  

You need to add the file ```manifest.yaml``` as resource in your kustomization file.  It is generated from the values you provided.

```yaml
resources:
  - manifest.yaml # file generated by helm template from values.yaml
  ...
```
