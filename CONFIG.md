# Default Configuration

> Delivered configuration corresponds to a platform that can be used without processing chains. It covers the following points :
>
> - definition of system resources required for services
> - definition of sufficient storage for services
> - high availability of services
>
> When adding an RS-ADDON / RS-CORE, the following COTS will need to be re-configured:
>
> - Storage size for Elasticsearch processing
> - Storage size for Elasticsearch security
> - Storage size for Kafka
> - Storage size for Loki
> - Storage size for Rook Ceph

## Default network and infrastructure

- 2 public IPs for egress
- 2 publics IPs for the gateways
- 1 private network with all the machines
- 3 additional volumes of 2 TB for the Ceph filesystem
- 4 S3 buckets for ES processing, ES security, Thanos and Loki
- Platform with 20 nodes :
  - 2 Gateway (VM : 4 CPUs / 8 Go RAM)
  - 3 Master (VM : 4 CPUs / 8 Go RAM)
  - 8 Infra Worker (VM : 4 CPUs / 16 Go RAM)
  - 3 Ceph filesystem nodes (VM : 8 CPUs / 16 Go RAM)
  - 2 Specific Workers for Prometheus  (VM : 8 CPUs / 32 Go RAM)
  - 2 Egress (VM : 4 CPUs / 16 Go RAM)

## Configuration of COTS

|   |   |
| - | - |
| **Apisix** | - Namespace : networking <br> ------------------------ <br> **apisix** <br> - QoS : Burstable <br> - Replicas : 3 <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : n/a <br> &nbsp;&nbsp;&nbsp; - Limits Memory : n/a <br> &nbsp;&nbsp;&nbsp; - Request CPU : 30m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 256Mi <br> ------------------------ <br> **dashboard** <br> - QoS : Burstable <br> - Replicas : 1 <br> ------------------------ <br> **etcd** <br> - QoS : Burstable <br> - Replicas : 3 <br> - Persistent Volume : <br> &nbsp;&nbsp;&nbsp; - Size : 8Gi <br> &nbsp;&nbsp;&nbsp; - Access Mode : ReadWriteOnce <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : n/a <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 600Mi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 20m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 100Mi <br> ------------------------ <br> **ingress controller** <br> - QoS : Burstable <br> - Replicas : 2 <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 50m <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 128Mi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 10m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 64Mi |
| **Calico** | - Namespace : kube-system <br> ------------------------ <br> **calico** <br> - QoS : Burstable <br> - Replicas : Daemonset <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 300m <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 500M <br> &nbsp;&nbsp;&nbsp; - Request CPU : 150m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 64M <br> ------------------------ <br> **kube-controller** <br> - QoS : Burstable <br> - Replicas : 1 <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 100m <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 256M <br> &nbsp;&nbsp;&nbsp; - Request CPU : 30m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 64M |
| **Cert-manager** | - Namespace : infra <br> ------------------------ <br> **cert-manager** <br> - QoS : Burstable <br> - Replicas : 1 <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 20m <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 100Mi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 10m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 50Mi <br> ------------------------ <br> **cainjector** <br> - QoS : Burstable <br> - Replicas : 1 <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 20m <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 200Mi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 10m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 100Mi  <br> ------------------------ <br> **webhook** <br> - QoS : Burstable <br> - Replicas : 1 <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 20m <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 40Mi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 10m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 20Mi |
| **Cluster autoscaler** | - Namespace : kube-system <br> - QoS : Burstable <br> - Replicas : 1 <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 1 <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 512Mi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 100m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 256Mi |
| **CoreDNS** | - Namespace : kube-system <br> ------------------------ <br> **coredns** <br> - QoS : Burstable <br> - Replicas : 2 <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 170Mi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 100m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 70Mi <br> ------------------------ <br> **localdns** <br> - QoS: Burstable <br> - Replicas : Daemonset <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 170Mi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 100m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 70Mi <br> ------------------------ <br> **dns autoscaler** <br> - QoS : Burstable <br> - Replicas : 1 <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Request CPU : 20m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 10Mi |
| **Elastic Operator** | - Namespace : infra <br> - QoS : Burstable <br> - Replicas : 1 <br>- Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 500m <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 256Mi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 100m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 128Mi |
| **Elasticsearch processing** | - Namespace : database <br> - Priority Class : 900000 <br> ------------------------ <br> **coordinating** <br> - QoS : Burstable <br> - Replicas : 2 <br> - Persistent Volume : <br> &nbsp;&nbsp;&nbsp; - Size : 1Gi <br> &nbsp;&nbsp;&nbsp; - Access Mode : ReadWriteOnce <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 500m <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 6Gi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 100m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 4Gi <br> ------------------------ <br> **data** <br> - QoS : Burstable <br> - Replicas : 3 <br> - Persistent Volume : <br> &nbsp;&nbsp;&nbsp; - Size : 100Gi <br> &nbsp;&nbsp;&nbsp; - Access Mode : ReadWriteOnce <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 2 <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 8Gi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 100m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 4Gi <br> ------------------------ <br> **exporter** <br> - QoS : Burstable <br> - Replicas : 1 <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 100m <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 256Mi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 50m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 128Mi |
| **Elasticsearch security**   | - Namespace : security <br> - Priority Class : 900000 <br> ------------------------ <br> **coordinating** <br> - QoS : Burstable <br> - Replicas : 2 <br> - Persistent Volume : <br> &nbsp;&nbsp;&nbsp; - Size : 1Gi <br> &nbsp;&nbsp;&nbsp; - Access Mode : ReadWriteOnce <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 400m <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 6Gi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 100m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 4Gi <br> ------------------------ <br> **data** <br> - QoS : Burstable <br> - Replicas : 3 <br> - Persistent Volume : <br> &nbsp;&nbsp;&nbsp; - Size : 100Gi <br> &nbsp;&nbsp;&nbsp; - Access Mode : ReadWriteOnce <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 2 <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 8Gi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 100m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 4Gi <br> ------------------------ <br> **exporter** <br> - QoS : Burstable <br> - Replicas : 1 <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 100m <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 256Mi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 50m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 128Mi |
| **Etcd** | - Namespace : kube-system <br> - QoS : Burstable <br> - Replicas: 3 <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Request CPU : 100m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 100Mi |
| **Falco** | - Namespace : security <br> - Priority Class : 10000000 <br> - QoS : Burstable <br> - Replicas : Daemonset <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 200m <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 256Mi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 100m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 50Mi |  
| **Falco Exporter** | - Namespace : security <br> - QoS : Burstable <br> - Replicas : Daemonset <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 10m <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 20Mi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 5m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 10Mi |  
| **Fluentbit** | - Namespace : logging <br> - Priority Class : 10000000 <br> - QoS : Burstable <br> - Replicas : Daemonset <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 150m <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 512Mi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 25m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 64Mi |
| **Fluentd** | - Namespace : logging <br> - QoS : Burstable <br> - Replicas : 2 <br> - Persistent Volume :  <br> &nbsp;&nbsp;&nbsp; - Size : 10Gi <br> &nbsp;&nbsp;&nbsp; - Access Mode : ReadWriteOnce <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 500m <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 512Mi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 100m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 256Mi |
| **Finops Object Storage Exporter** | - Namespace : monitoring <br> - QoS : BestEffort <br> - Replicas : 1 |
| **Finops Ressources Exporter** | - Namespace : monitoring <br> - QoS : Burstable <br> - Replicas : 1 |
| **Grafana** | - Namespace : monitoring <br> ------------------------ <br> **grafana** <br> - QoS : Burstable <br> - Replicas : 1 <br> - Persistent Volume :  <br> &nbsp;&nbsp;&nbsp; - Size : 8Gi <br> &nbsp;&nbsp;&nbsp; - Access Mode : ReadWriteOnce <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 500m <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 1Gi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 200m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 256Mi <br> ----------------------------- <br>  - QoS : Burstable <br> - Replicas : 1 <br> ------ <br> **manager** <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 400m <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 512Mi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 100m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 256Mi <br> ------ <br> **kube-rbac-proxy** <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 10m <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 20Mi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 5m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 10Mi |
| **Graylog** | - Namespace : security <br> - QoS : Burstable <br> - Replicas : 2 <br> - Persistent Volume :  <br> &nbsp;&nbsp;&nbsp; - Size : 10Gi <br> &nbsp;&nbsp;&nbsp; - Access Mode : ReadWriteOnce <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 2 <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 2Gi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 500m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 1Gi |
| **Kafka Cluster** | - Namespace : infra <br> ------------------------ <br> **operator** <br> - QoS : Burstable <br> - Replicas : 1 <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 500m <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 1Gi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 100m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 512Mi <br> ------------------------ <br> **kafka** <br> - QoS : Burstable <br> - Replicas : 3 <br> - Persistent Volume :  <br> &nbsp;&nbsp;&nbsp; - Size : 200Gi <br> &nbsp;&nbsp;&nbsp; - Access Mode : ReadWriteOnce <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 1 <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 4Gi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 200m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 2Gi <br> ------------------------ <br> **entity-operator** <br> - QoS : Burstable <br> - Replicas : 1 <br> ------ <br> **topic-operator** <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 200m <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 400Mi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 50m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 200Mi <br> ------ <br> **user-operator** <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 200m <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 400Mi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 50m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 200Mi <br> ------------------------ <br> **exporter** <br>  - QoS : Burstable <br> - Replicas : 1 <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 200m <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 128Mi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 40m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 32Mi <br> ------------------------ <br> **zookeeper** <br> - QoS : Burstable <br> - Replicas : 3 <br> - Persistent Volume :  <br> &nbsp;&nbsp;&nbsp; - Size : 50Gi <br> &nbsp;&nbsp;&nbsp; - Access Mode : ReadWriteOnce <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 200m <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 1500Mi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 100m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 750Mi |
| **Keda** | --Namespace : infra <br> ------------------------ <br> **operator** <br> - Replicas : 1 <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 1 <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 1000Mi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 100m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 100Mi <br> ------------------------ <br> **metrics apiserver** <br> - Replicas : 1 <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 1 <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 1000Mi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 100m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 100Mi  |
| **Keycloak** | - Namespace : iam <br> - QoS : Burstable <br> - Replicas : 1 <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 500m <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 2Gi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 250m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 512Mi |
| **Kibana processing** | - Namespace : database <br> - QoS : Burstable <br> - Replicas : 1 <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 1Gi <br> &nbsp;&nbsp;&nbsp;  - Request Memory : 1Gi |
| **Kibana security** | - Namespace : security <br> - QoS : Burstable <br> - Replicas : 1 <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 1Gi <br> &nbsp;&nbsp;&nbsp;  - Request Memory : 1Gi |
| **Kubernetes** | - Namespace : kube-system <br> ------------------------ <br> **kube-apiserver** <br> - QoS : Burstable <br> - Replicas : 3 <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Request CPU : 250m <br> ------------------------ <br> **kube-controller-manager** <br> - QoS : Burstable <br> - Replicas : 3 <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Request CPU : 200m <br> ------------------------ <br> **kube-scheduler** <br> - QoS : Burstable <br> - Replicas : 3 <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Request CPU : 100m <br> ------------------------ <br> **nginx-proxy** <br> - QoS : Burstable <br> - Replicas : Daemonset <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Request CPU : 25m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 32m |
| **Linkerd** | - Namespace : networking <br> ------------------------ <br> **linkerd-destination** <br> - QoS : Burstable <br> - Replicas : 3 <br> ------ <br> **destination** <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 50m  <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 200Mi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 10m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 100Mi <br> ------ <br> **sp-validator** <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 10m  <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 56Mi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 5m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 28Mi <br> ------ <br> **policy** <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 10m  <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 56Mi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 5m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 28Mi <br> ------------------------ <br> **linkerd-identity** <br> - QoS : Burstable <br> - Replicas : 3 <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 50Mi <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 64Mi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 10m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 32Mi <br> ------------------------ <br> **linkerd-proxy-injector** <br> - QoS : Burstable <br> - Replicas : 3 <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 50Mi <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 144Mi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 10m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 72Mi <br> ------------------------ <br> **metrics-api** <br> - QoS : Burstable <br> - Replicas : 1 <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 50m  <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 128Mi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 5m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 64Mi <br> ------------------------ <br> **tap** <br> - QoS : Burstable <br> - Replicas : 1 <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 20m  <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 200Mi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 10m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 100Mi <br> ------------------------ <br> **tap-injector** <br> - QoS : Burstable <br> - Replicas : 1 <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 10m  <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 40Mi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 5m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 20Mi <br> ------------------------ <br> **web** <br> - QoS : Burstable <br> - Replicas : 1 <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 10m  <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 64Mi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 5m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 32Mi <br> ------------------------ <br> **linkerd-proxy** <br> - Replicas : Sidecar (several namespaces) <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 100m <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 250Mi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 50m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 20Mi |
| **Loki distributed** | - Namespace : logging <br> ------------------------ <br> **ingester** <br> - QoS : Burstable <br> - Replicas : 3-15 <br> - Persistent Volume :  <br> &nbsp;&nbsp;&nbsp; - Size : 20Gi <br> &nbsp;&nbsp;&nbsp; - Access Mode : ReadWriteOnce <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 250m <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 1Gi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 100m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 512Mi <br> ------------------------ <br> **querier** <br> - QoS : Burstable <br> - Replicas : 3 <br> - Persistent Volume :  <br> &nbsp;&nbsp;&nbsp; - Size : 20Gi <br> &nbsp;&nbsp;&nbsp; - Access Mode : ReadWriteOnce <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 1 <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 2Gi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 50m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 128Mi <br> ------------------------ <br> **distributor** <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 300m <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 256Mi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 100m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 128Mi <br> ------------------------ <br> **compactor** <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 100m <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 256Mi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 20m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 64Mi <br> ------------------------ <br> **queryFrontend** <br>  - QoS : Burstable <br> - Replicas : 2 <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 100m <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 256Mi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 40m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 64Mi |
| **MongoDB** | - Namespace : database <br> ----------------------------- <br> - QoS : Burstable <br> - Replicas : 3  <br> ------ <br> **mongodb** <br> - Persistent Volume :  <br> &nbsp;&nbsp;&nbsp; - Size : 30Gi <br> &nbsp;&nbsp;&nbsp; - Access Mode : ReadWriteOnce <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 300m <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 2Gi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 100m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 512Mi <br> ------ <br> **metrics** <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 50m <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 128Mi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 20m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 64Mi <br> ----------------------------- <br> **arbiter** <br> - QoS : Burstable <br> - Replicas : 1 |
| **OpenLDAP** | - Namespace : iam <br> - QoS : Burstable <br> - Replicas : 2 <br> - Persistent Volume :  <br> &nbsp;&nbsp;&nbsp; - Size : 8Gi <br> &nbsp;&nbsp;&nbsp; - Access Mode : ReadWriteOnce <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 50m <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 128Mi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 10m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 72Mi |
| **PostgreSQL** | - Namespace : database <br> ----------------------------- <br> **primary** <br> - QoS : Burstable <br> - Replicas : 1 <br> - Persistent Volume :  <br> &nbsp;&nbsp;&nbsp; - Size : 30Gi <br> &nbsp;&nbsp;&nbsp; - Access Mode : ReadWriteOnce <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 250m <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 2Gi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 50m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 512Mi <br> ----------------------------- <br> **read** <br> - QoS : Burstable <br> - Replicas : 2 <br> - Persistent Volume :  <br> &nbsp;&nbsp;&nbsp; - Size : 30Gi <br> &nbsp;&nbsp;&nbsp; - Access Mode : ReadWriteOnce <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 250m <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 2Gi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 50m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 512Mi |
| **PostgreSQL Exporter** | - Namespace : database <br> ----------------------------- <br> **Keycloak Exporter** <br> - QoS : Burstable <br> - Replicas : 1 <br> ----------------------------- <br> **Spring Cloud Data Flow Exporter** <br> - QoS : Burstable <br> - Replicas : 1 <br> ----------------------------- <br> **Spring Cloud Data Flow Skipper Exporter** <br> - QoS : Burstable <br> - Replicas : 1 |
| **Prometheus Operator** | - Namespace : infra <br> - QoS : Burstable <br> - Replicas : 1 <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 50m <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 256Mi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 10m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 128Mi |
| **Prometheus Stack** | - Namespace : logging <br> - Priority Class : 1000000 <br> ----------------------------- <br> - QoS : Burstable <br> - Replicas : 1 <br> ------ <br> **alertmanager** <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 50m <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 128Mi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 10m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 64Mi <br> ----- <br> **config-reloader** <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 10m <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 64Mi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 10m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 64Mi <br> ----------------------------- <br> - QoS : Burstable <br> - Replicas : 2 <br> ------ <br> **prometheus** <br>- Persistent Volume :  <br> &nbsp;&nbsp;&nbsp; - Size : 20Gi <br> &nbsp;&nbsp;&nbsp; - Access Mode : ReadWriteOnce <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 4 <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 20Gi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 2 <br> &nbsp;&nbsp;&nbsp; - Request Memory : 8Gi <br> ---- <br> **config-reloader** <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 10m <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 64Mi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 10m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 64Mi <br> ----------------------------- <br> **kube-state-metrics** <br> - QoS : Burstable <br> - Replicas : 1 <br> ---------------------------- <br> **node-exporter** <br> - QoS : Burstable <br> - Replicas : Daemonset <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 30m <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 60Mi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 15m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 30Mi <br> ---------------------------- <br> **thanos-sidecar** <br> - Replicas : Sidecar <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 100m <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 2Gi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 25m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 512Mi <br> ---------------------------- <br> **thanos-compactor** <br> - QoS : Burstable <br> - Replicas : 1 <br> - Persistent Volume :  <br> &nbsp;&nbsp;&nbsp; - Size : 100Gi <br> &nbsp;&nbsp;&nbsp; - Access Mode : ReadWriteOnce <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 500m <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 2Gi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 100m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 512Mi <br> ---------------------------- <br> **thanos-query** <br> - QoS : Burstable <br> - Replicas : 1 <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 500m <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 2Gi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 100m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 512Mi <br> ---------------------------- <br> **thanos-storegateway** <br> - QoS : Burstable <br> - Replicas : 1 <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 500m <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 2Gi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 100m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 512Mi |
| **Rclone** | - Namespace : security <br> - QoS : BestEffort <br> - Replicas : CronJob |
| **Rook Ceph** | - Namespace : rook-ceph <br> - Priority Class : 10000000 <br> - Ceph Block Pools Replicated : 3 <br> ---------------------------- <br> **csi-rbdplugin** <br> - QoS : Burstable <br> - Replicas : Daemonset <br> ------ <br> **driver-registrar**<br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 20m <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 20Mi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 10m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 10Mi <br> ------ <br> **csi-rbdplugin** <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 10m <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 200Mi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 5m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 100Mi <br> ------ <br> **liveness-prometheus**<br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 10m <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 40Mi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 5m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 20Mi <br> ---------------------------- <br> **csi-rbdplugin-provisioner** <br> - QoS : Burstable <br> - Replicas : 2 <br> ------ <br> **csi-provisioner** <br> ------ <br> **csi-resizer** <br> ------ <br> **csi-attacher** <br> ------ <br> **csi-snapshotter** <br> ------ <br> **csi-rdbplugin** <br> ------ <br> **liveness-prometheus** <br> ---------------------------- <br> **rook-ceph-operator** <br> - QoS : Burstable <br> - Replicas : 1 <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : n/a <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 256Mi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 100m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 128Mi <br> ---------------------------- <br> - QoS : Burstable <br> - Replicas : 2 <br> ------ <br> **mgr** <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 500m <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 1Gi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 500m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 1Gi <br> ------<br> **watch-active** <br> ---------------------------- <br> **mon** <br> - QoS : Burstable <br> - Replicas : 3 <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 500m <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 1Gi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 500m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 1Gi <br> ---------------------------- <br> **rook-ceph-crashcollector** <br> - QoS : Burstable <br> - Replicas : Daemonset <br> ---------------------------- <br> **osd** <br> - QoS : Guaranteed <br> - Replicas : Daemonset <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 1 <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 2Gi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 1 <br> &nbsp;&nbsp;&nbsp; - Request Memory : 2Gi  <br> ---------------------------- <br> **rook-ceph-tools** <br> - QoS : Burstable <br> - Replicas : 1 |
| **RS Infra Scaler** | - Namespace : kube-system <br> - QoS : Burstable <br> - Replicas : 1 <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 1 <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 512Mi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 200m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 256Mi |
| **SafeScale daemon** | - Namespace : kube-system <br> - QoS : Burstable <br> - Replicas : 1 <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 1 <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 512Mi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 100m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 256Mi |
| **Spring Cloud Data Flow** | - Namespace : processing <br> ---------------------------- <br> **server** <br> - QoS : Burstable <br> - Replicas : 1 <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 1 <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 2Gi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 500m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 1Gi <br> ---------------------------- <br> **skipper** <br> - QoS : Burstable <br> - Replicas : 1 <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 1 <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 2Gi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 500m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 1Gi <br> ---------------------------- <br> **prometheus-proxy** <br> - QoS : Burstable <br> - Replicas : 1 <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 500m <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 256Mi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 100m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 128Mi |  
| **Stash** | - Namespace : infra <br> - QoS : Burstable <br> - Replicas : 1 <br> ------ <br> **operator** <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 100m <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 512Mi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 50m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 128Mi  <br> ------ <br> **pushgateway** <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 100m <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 128Mi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 50m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 64Mi |
| **Kubelet rubber stamp** | - Namespace : kube-system <br> - QoS : Burstable <br> - Replicas : 1 <br> - Ressources : <br> &nbsp;&nbsp;&nbsp; - Limits CPU : 50m <br> &nbsp;&nbsp;&nbsp; - Limits Memory : 20Mi <br> &nbsp;&nbsp;&nbsp; - Request CPU : 10m <br> &nbsp;&nbsp;&nbsp; - Request Memory : 10Mi |

## Predefined user, groups and client roles

![group and roles](./docs/media/groups_and_roles.svg)

## Exposed services

| Exposed service | URL subdomain | URL subpath | Notes |
| --------------- | ------------- | ----------- | ----- |
| apisix | apisix | /* | |
| kube-apiserver | kube | /* | |
| linkerd | linkerd | /* | |
| grafana | monitoring | /* | |
| prometheus | monitoring | /prometheus | |
| thanos | monitoring | /thanos/ | |
| kibana processing | processing | /kibana | |
| spring cloud dataflow | processing | /* | |
| kibana security | security | /kibana | |
| graylog | security | /* | |
| keycloack | iam | /auth/admin/RS/console | for users of group _admin_ |
| keycloack | iam | /auth/realms/RS/account | for all users |
| ceph dashboard | ceph | /* | admin password in the 'rook-ceph-dashboard-password' secret |

## ETL

| Source (Logs) | Topics (Kafka) | Consumer | Nb consumer | Destination |
| ------------- | :------------: | :------: | :---------: | ----------- |
| /var/log/containers/\*.log <br><br>Excluded : <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- /var/log/containers/\*fluent\*.log <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- /var/log/containers/keycloak-?_iam_keycloak-\*.log <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- /var/log/containers/apisix-\*_networking_apisix-\*.log <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- /var/log/containers/falco-?????_security_falco\*.log <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- /var/log/containers/nmap-job-\*.log </br></br> **All logs** | -- | -- | -- | Loki |
| /var/log/containers/\*.log <br><br>Excluded : <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- /var/log/containers/\*fluent\*.log <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- /var/log/containers/keycloak-?_iam_keycloak-\*.log <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- /var/log/containers/apisix-\*_networking_apisix-\*.log <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- /var/log/containers/falco-?????_security_falco\*.log <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- /var/log/containers/nmap-job-\*.log </br></br> **Only log JSON contains : `header.type: REPORT`** | fluentbit.trace | fluentd | 2 | Elasticsearch Processing |
| /var/log/syslog <br><br> **Exclude `syslog_identifier clamd`**| -- | -- | -- | Loki |
| /var/log/containers/keycloak-?_iam_keycloak-\*.log | fluentbit.keycloak | graylog | 2 | Elasticsearch Security |
| /var/log/containers/apisix-\*_networking_apisix-\*.log | fluentbit.ingress | graylog | 2 | Elasticsearch Security |
| /var/ossec/logs/alerts/alerts.json | fluentbit.wazuh | graylog | 2 | Elasticsearch Security |
| /var/log/audit_\*.log | fluentbit.auditd | graylog | 2 | Elasticsearch Security |
| /var/log/containers/falco-?????_security_falco\*.log | fluentbit.falco | graylog | 2 | Elasticsearch Security |

## Kafka Topics

| Topic | Partition | Replication Factor | Segment Size (bytes) | Retention (time in ms) | Retention (size in bytes) | Cleanup Policy | Min Insync Replicas | Unclean Leader Election Enabled |
| -- | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: |
| fluentbit.auditd | 6 | 3 | 1789956970 | | 715827882 | delete | 2 | false |
| fluentbit.falco | 6 | 3 | 1789956970 | | 715827882 | delete | 2 | false |
| fluentbit.ingress | 6 | 3 | 1789956970 | | 715827882 | delete | 2 | false |
| fluentbit.keycloak | 6 | 3 | 1789956970 | | 715827882 | delete | 2 | false |
| fluentbit.trace | 6 | 3 | 89478485 | 604800000 | | delete | 2 | false |
| fluentbit.wazuh | 6 | 3 | 1789956970 | | 715827882 | delete | 2 | false |

## Logs and metrics retention

| Destination | Retention | Infos |
| ----------- | --------- | ----- |
| Loki S3 bucket | 1460h (~60d) | ||
| Prometheus | 2d | metrics are saved in S3 via Thanos |
| Thanos S3 bucket | 30d | 5m resolution |
| Thanos S3 bucket | 10 years | 1h resolution |
| Elasticsearch processing | lifetime retention | |
| Elasticsearch security | 6 months | |
