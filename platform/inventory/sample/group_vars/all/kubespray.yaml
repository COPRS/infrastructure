kube_version: v1.22.2

etcd_kubeadm_enabled: true

## Networking
kube_network_plugin: calico
calico_version: "v3.19.2"
ipip: false
calico_vxlan_mode: Always

kube_proxy_mode: iptables

kube_service_addresses: 10.96.0.0/12
kube_pods_subnet: 10.244.0.0/16

cluster_name: cluster.local

## Container runtime
## Kubernetes need to configure containerd cgroup driver.
## Enabling kubespray container engine deployment ensure  containerd config file is set.
## deploy_container_engine: false
container_manager: containerd

## last version on ubuntu 20.04 is 1.4.11-1 and kubespray doesn't support it yet
## but it is already installed in fe ubuntu 20.04 base image
## to fix this: downgrade containerd to last version supported by crictl: 1.4.9-1
# containerd_package_info:
#   pkgs:
#     "containerd.io=1.4.11-1"

## Kubeadm config
podsecuritypolicy_enabled: true

kube_apiserver_enable_admission_plugins: [NodeRestriction]

kube_kubeadm_controller_extra_args:
  use-service-account-credentials: true

kubernetes_audit: true
audit_log_path: /var/log/k8s_audit.log
audit_log_maxage: 30
audit_log_maxbackups: 10
audit_log_maxsize: 100

## oidc config
# kube_oidc_url: https:// ...
# kube_oidc_client_id: kubernetes
## Optional settings for OIDC
# kube_oidc_username_claim: sub
# kube_oidc_username_prefix: 'oidc:'
# kube_oidc_groups_claim: groups
# kube_oidc_groups_prefix: 'oidc:'
# Copy oidc CA file to the following path if needed
# kube_oidc_ca_file: {{ kube_cert_dir }}/ca.pem
# Optionally include a base64-encoded oidc CA cert
# kube_oidc_ca_cert: c3RhY2thYnVzZS5jb20...

##  to get kubectl config file generated in library/kubespray/inventory/mycluster/artifacts/
kubeconfig_localhost: true
